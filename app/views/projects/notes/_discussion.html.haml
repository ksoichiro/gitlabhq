- note = discussion_notes.first
.discussion.js-toggle-container{ class: note.discussion_id }
  .discussion-header
    .discussion-actions
      = link_to "#", class: "js-toggle-button" do
        %i.icon-chevron-up
        ディスカッションを表示/非表示
    = image_tag avatar_icon(note.author_email), class: "avatar s32"
    %div
      = link_to_member(@project, note.author, avatar: false)
      - if note.for_merge_request?
        - if note.diff
          がこのマージリクエストの差分
          = link_to_merge_request_diff_line_note(note)
          についてディスカッションを始めました
        - else
          がこのマージリクエストの差分について
          %strong
            %i.icon-remove
            無効な
          ディスカッションを始めました
      - elsif note.for_commit?
        がコミット
        #{link_to note.noteable.short_id, project_commit_path(note.project, note.noteable)}
        = link_to_commit_diff_line_note(note) if note.for_diff_line?
        についてディスカッションを始めました
      - else
        %cite.cgray がディスカッションを始めました
    %div
      - last_note = discussion_notes.last
      最終更新者：
      = link_to_member(@project, last_note.author, avatar: false)
      %span.discussion-last-update
        #{time_ago_with_tooltip(last_note.updated_at, 'bottom', 'discussion_updated_ago')}
  .discussion-body.js-toggle-content
    - if note.for_diff_line?
      - if note.active?
        = render "projects/notes/discussion_diff", discussion_notes: discussion_notes, note: note
      - else
        = link_to '無効なディスカッションを表示', '#', class: 'js-show-outdated-discussion'
        %div.hide.outdated-discussion
          .notes{ rel: discussion_notes.first.discussion_id }
            = render discussion_notes

    - else
      .notes{ rel: discussion_notes.first.discussion_id }
        = render discussion_notes
      = render "projects/notes/discussion_reply_button", note: discussion_notes.first
