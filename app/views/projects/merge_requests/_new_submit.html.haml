%h3.page-title
  新しいマージリクエスト
%p.slead
  From
  %strong.label-branch #{@merge_request.source_project_namespace}:#{@merge_request.source_branch}
  %span into
  %strong.label-branch #{@merge_request.target_project_namespace}:#{@merge_request.target_branch}

  %span.pull-right
    = link_to 'ブランチを変更', new_project_merge_request_path(@project)

= form_for [@project, @merge_request], html: { class: "merge-request-form gfm-form" } do |f|
  .panel.panel-default

    .panel-body
      .form-group
        .light
          = f.label :title do
            タイトル *
        = f.text_field :title, class: "form-control input-lg js-gfm-input", maxlength: 255, rows: 5, required: true
      .form-group
        .light
          = f.label :description, "説明"
        = render layout: 'projects/md_preview' do
          = render 'projects/zen', f: f, attr: :description,
                                   classes: 'description form-control'
          .clearfix.hint
            .pull-left 説明は#{link_to "GitLab Flavored Markdown", help_page_path("markdown", "markdown"), target: '_blank'}形式でパースされます。
            .pull-right ドラッグ &amp; ドロップまたは#{link_to "ファイルを選択", '#', class: 'markdown-selector' }して画像 (JPG, PNG, GIF) を添付
          .error-alert
      .form-group
        .issue-assignee
          = f.label :assignee_id do
            %i.fa.fa-user
            担当者
          %div
            = project_users_select_tag('merge_request[assignee_id]', placeholder: 'Select a user', class: 'custom-form-control', selected: @merge_request.assignee_id, project_id: @merge_request.target_project_id)
            &nbsp;
            = link_to '自分に割り当て', '#', class: 'btn assign-to-me-link'
      .form-group
        .issue-milestone
          = f.label :milestone_id do
            %i.fa.fa-clock-o
            マイルストーン
          %div= f.select(:milestone_id, milestone_options(@merge_request), { include_blank: "マイルストーンを選択" }, {class: 'select2'})
      .form-group
        = f.label :label_ids do
          %i.fa.fa-tag
          ラベル
        %div
          = f.collection_select :label_ids, @merge_request.target_project.labels.all, :id, :name, { selected: @merge_request.label_ids }, multiple: true, class: 'select2'

    .panel-footer
      - if contribution_guide_url(@target_project)
        %p
          このリポジトリの
          %strong #{link_to "コントリビューション・ガイドライン", contribution_guide_url(@target_project)}
          を確認してください
      = f.hidden_field :source_project_id
      = f.hidden_field :target_project_id
      = f.hidden_field :target_branch
      = f.hidden_field :source_branch
      = f.submit 'マージリクエストを送信', class: "btn btn-create"

.mr-compare
  = render "projects/commits/commit_list"

  %h4 変更
  - if @diffs.present?
    = render "projects/diffs/diffs", diffs: @diffs, project: @project
  - elsif @commits.size > MergeRequestDiff::COMMITS_SAFE_SIZE
    .bs-callout.bs-callout-danger
      %h4 この比較には #{MergeRequestDiff::COMMITS_SAFE_SIZE} コミット以上が含まれています
      %p パフォーマンスを維持するため、行は表示されません。
  - else
    .bs-callout.bs-callout-danger
      %h4 この比較の差分は大きすぎます
      %p パフォーマンスを維持するため、差分行は表示されません。


:javascript
  $('.assign-to-me-link').on('click', function(e){
    $('#merge_request_assignee_id').val("#{current_user.id}").trigger("change");
    e.preventDefault();
  });

  window.project_image_path_upload = "#{upload_image_project_path @project}";
